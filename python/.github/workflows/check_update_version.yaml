---
name: Check new version

on:
  push:
    branches:
    - main
    paths:
    - setup.cfg

jobs:
  check:
    runs-on: self-hosted
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Get version
      id: version
      run: echo "::set-output name=version::$(awk -F '=' '/version/ {print $2}' setup.cfg | tr -d ' ')"
    - uses: mukunku/tag-exists-action@v1.0.0
      id: checkTag
      with:
        tag: v${{ steps.version.outputs.version }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - name: Tag new version
      if: ${{ steps.checkTag.outputs.exists != 'true' }}
      uses: tvdias/github-tagger@v0.0.2
      with:
        repo-token: ${{ secrets.TOKEN_PACKAGES }}
        tag: v${{ steps.version.outputs.version }}